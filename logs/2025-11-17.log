{"timestamp":"2025-11-17T06:09:33.906Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"test_user_id","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":9052}
{"timestamp":"2025-11-17T06:10:34.588Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"test_user_id","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":20716}
{"timestamp":"2025-11-17T06:10:34.594Z","level":"INFO","message":"[oauth-utils] Creating new integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":20716}
{"timestamp":"2025-11-17T06:10:34.610Z","level":"INFO","message":"[oauth-utils] Created new integration connection and saved to database","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":20716}
{"timestamp":"2025-11-17T06:24:32.292Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"test_user_id","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":7884}
{"timestamp":"2025-11-17T06:24:32.296Z","level":"INFO","message":"[oauth-utils] Connection data prepared","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"test_user_id","hasAccessToken":true,"hasRefreshToken":true,"expiresAt":"2025-11-17T07:24:32.295Z"},"pid":7884}
{"timestamp":"2025-11-17T06:24:32.310Z","level":"INFO","message":"[oauth-utils] Updating existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":7884}
{"timestamp":"2025-11-17T06:24:32.351Z","level":"INFO","message":"[oauth-utils] Updated existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":7884}
{"timestamp":"2025-11-17T06:52:01.311Z","level":"INFO","message":"[oauth-utils] Exchanging code for tokens","meta":{"integrationKey":"facebook","code":"present","redirectUri":"https://spark-frontend-production.up.railway.app/integrations/callback","clientId":"present","clientSecret":"present"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.316Z","level":"INFO","message":"[oauth-utils] OAuth token exchange request details","meta":{"integrationKey":"facebook","redirectUri":"https://spark-frontend-production.up.railway.app/integrations/callback","clientId":"23025..."},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.317Z","level":"INFO","message":"[oauth-utils] Exchanging code with Facebook/Instagram","meta":{"clientId":"2302564490171864","redirectUri":"https://spark-frontend-production.up.railway.app/integrations/callback"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.753Z","level":"ERROR","message":"[integration-monitoring] Integration error recorded","meta":{"integrationKey":"facebook","errorType":"oauth/token","errorMessage":"Request failed with status code 400"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.753Z","level":"ERROR","message":"[oauth-utils] Error exchanging OAuth code for tokens","meta":{"integrationKey":"facebook","error":"Request failed with status code 400","response":{"error":{"message":"لا يمكن تحميل عنوان URL: لم يتم تضمين نطاق عنوان URL هذا في نطاقات التطبيق. للتمكن من تحميل عنوان URL هذا، يرجى إضافة كل النطاقات والنطاقات الفرعية لتطبيقك إلى الحقل \"نطاقات التطبيق\" في إعدادات التطبيق.","type":"OAuthException","code":191,"fbtrace_id":"Ap6PW39nwvi5Vzx_lLsXODG"}},"status":400,"stack":"AxiosError: Request failed with status code 400\n    at settle (c:\\Users\\user\\Downloads\\winnerforce-spark-main\\clean-project\\Spark-backend\\node_modules\\axios\\dist\\node\\axios.cjs:2106:12)\n    at BrotliDecompress.handleStreamEnd (c:\\Users\\user\\Downloads\\winnerforce-spark-main\\clean-project\\Spark-backend\\node_modules\\axios\\dist\\node\\axios.cjs:3491:11)\n    at BrotliDecompress.emit (node:events:524:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n    at Axios.request (c:\\Users\\user\\Downloads\\winnerforce-spark-main\\clean-project\\Spark-backend\\node_modules\\axios\\dist\\node\\axios.cjs:4731:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async exchangeCodeForTokens (c:\\Users\\user\\Downloads\\winnerforce-spark-main\\clean-project\\Spark-backend\\utils\\integrations\\oauthUtils.js:51:25)\n    at async testOAuthProcess (c:\\Users\\user\\Downloads\\winnerforce-spark-main\\clean-project\\Spark-backend\\scripts\\testOAuthProcess.js:56:25)"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.755Z","level":"INFO","message":"[oauth-utils] Connection data prepared","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"test_user_id","hasAccessToken":true,"hasRefreshToken":true,"expiresAt":"2025-11-17T07:52:01.755Z"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.755Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"test_user_id","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.754Z","level":"ERROR","message":"[oauth-utils] OAuth provider error details","meta":{"integrationKey":"facebook","status":400,"statusText":"Bad Request","data":{"error":{"message":"لا يمكن تحميل عنوان URL: لم يتم تضمين نطاق عنوان URL هذا في نطاقات التطبيق. للتمكن من تحميل عنوان URL هذا، يرجى إضافة كل النطاقات والنطاقات الفرعية لتطبيقك إلى الحقل \"نطاقات التطبيق\" في إعدادات التطبيق.","type":"OAuthException","code":191,"fbtrace_id":"Ap6PW39nwvi5Vzx_lLsXODG"}}},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.768Z","level":"INFO","message":"[oauth-utils] Updating existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":9192}
{"timestamp":"2025-11-17T06:52:01.794Z","level":"INFO","message":"[oauth-utils] Updated existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":9192}
{"timestamp":"2025-11-17T06:55:38.835Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"69184f9941fbede3df957baa","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":18488}
{"timestamp":"2025-11-17T06:55:38.836Z","level":"INFO","message":"[oauth-utils] Connection data prepared","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"69184f9941fbede3df957baa","hasAccessToken":true,"hasRefreshToken":true,"expiresAt":"2025-11-17T07:55:38.836Z"},"pid":18488}
{"timestamp":"2025-11-17T06:55:38.839Z","level":"INFO","message":"[oauth-utils] Creating new integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"69184f9941fbede3df957baa"},"pid":18488}
{"timestamp":"2025-11-17T06:55:38.850Z","level":"INFO","message":"[oauth-utils] Created new integration connection and saved to database","meta":{"connectionId":"691ac6eac59e65115ad73266","integrationId":"69184f9941fbede3df957baa","userId":"69184f9941fbede3df957baa"},"pid":18488}
{"timestamp":"2025-11-17T07:02:57.942Z","level":"INFO","message":"[oauth-utils] Creating or updating integration connection","meta":{"integrationId":"69184f9941fbede3df957baa","integrationKey":"facebook","userId":"test_user_id","tokenDataKeys":["access_token","refresh_token","expires_in","token_type","scope"],"hasAccessToken":true,"hasRefreshToken":true},"pid":21112}
{"timestamp":"2025-11-17T07:02:57.947Z","level":"INFO","message":"[oauth-utils] Connection data prepared","meta":{"integrationId":"69184f9941fbede3df957baa","userId":"test_user_id","hasAccessToken":true,"hasRefreshToken":true,"expiresAt":"2025-11-17T08:02:57.946Z"},"pid":21112}
{"timestamp":"2025-11-17T07:02:57.963Z","level":"INFO","message":"[oauth-utils] Updating existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":21112}
{"timestamp":"2025-11-17T07:02:58.002Z","level":"INFO","message":"[oauth-utils] Updated existing integration connection","meta":{"connectionId":"691abc5a8eb26ea64fa4cc98","integrationId":"69184f9941fbede3df957baa","userId":"test_user_id"},"pid":21112}
